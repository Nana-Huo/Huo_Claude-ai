# 汉中市胆结石区域性风险调研

## 第一章 数据预处理

### 1.1 数据概述

本研究基于汉中市胆结石风险因素问卷数据，采用分层抽样方法收集。原始数据文件共202行，其中前2行为表头和编码说明，实际有效数据为200条记录，涵盖67个调查问题。

**数据规模**：
- 样本量：200条
- 特征数：67列（包含1个序号列和66个调查问题）
- 目标变量：胆结石患病情况

**目标变量分布**：
```
患病情况：
- 未患病：110人（55.00%）
- 患病：90人（45.00%）
```

数据集存在类别不平衡问题，患病率为45%，未患病率为55%。为避免模型偏向未患病类别，在后续建模中采用类别权重调整策略。

### 1.2 数据清洗

#### 1.2.1 缺失值处理

数据清洗过程中发现以下缺失值情况：

**缺失值处理策略**：
1. **逻辑跳过值**：如"(跳过)"等，根据问卷逻辑填充
   - 未患病者跳过治疗方式问题，标记为"未治疗"
   - 男性跳过女性相关问题，填充为"不适用"

2. **"不清楚"或"不变透露"**：标记为缺失值，后续用众数填充

3. **数值型异常值**：如体重"135kg"等，结合上下文判断是否为真实值

经过清洗，最终保留200条完整记录用于分析。

#### 1.2.2 异常值检测

**异常值检测方法**：使用IQR（四分位距）方法

**计算公式**：
```
Q1 = 第25百分位数
Q3 = 第75百分位数
IQR = Q3 - Q1
异常值下限 = Q1 - 1.5 × IQR
异常值上限 = Q3 + 1.5 × IQR
```

对身高、体重等数值型变量进行异常值检测，发现个别极端值（如体重135kg），结合实际情况判断为真实数据，予以保留。

### 1.3 数据转换与编码

#### 1.3.1 数值型变量标准化

**Z-score标准化公式**：
```
z = (x - μ) / σ
```
其中：
- x：原始值
- μ：均值
- σ：标准差

对身高、体重等数值型变量进行标准化处理，消除量纲影响。

#### 1.3.2 分类变量编码

**二分类变量**：采用标签编码（Label Encoding）
- 性别：男→0，女→1
- 吸烟：否→0，是→1
- 饮酒：否→0，是→1

**多分类变量**：采用独热编码（One-Hot Encoding）
- 年龄分组：20-40岁、40-60岁、61-80岁
- 县区：汉台区、城固县、南郑区等10个县区

为避免多重共线性，独热编码时创建k-1个哑变量。

#### 1.3.3 频率型变量数值化

将食品摄入频率转换为数值等级：

**频率等级映射**：
```
"≤3次/月" → 0
"3-7次/月" → 1
"≥7次/月" → 2
```

#### 1.3.4 时间型变量处理

将时间转换为分钟数：
- "10点半" → 630分钟
- "11点" → 660分钟

计算睡眠时长：
```
睡眠时长 = 起床时间 - 上床时间 - 入睡潜伏期
```

### 1.4 特征工程

#### 1.4.1 BMI计算

**BMI计算公式**：
```
BMI = 体重(kg) / [身高(m)]²
```

**BMI分类标准**：
- < 18.5：偏瘦
- 18.5-24：正常
- 24-28：超重
- ≥ 28：肥胖

**计算示例**：
- 身高178cm（1.78m），体重70kg
- BMI = 70 / (1.78)² = 22.1（正常）

#### 1.4.2 汉中特色食品

本研究特别关注汉中地区的特色食品，因为它们可能与胆结石风险密切相关。汉中位于陕西省南部，饮食文化具有鲜明特色。

**汉中特色食品分析**：

1. **汉中米皮**（第18列）：
   - 频率等级：≤3次/月（0），3-7次/月（1），≥7次/月（2）
   - 数据分布：≤3次/月（151人，75.5%），3-7次/月（48人，24%），≥7次/月（1人，0.5%）

2. **菜豆腐**（第19列）：
   - 频率等级：≤3次/月（0），3-7次/月（1），≥7次/月（2）
   - 数据分布：≤3次/月（178人，89%），3-7次/月（15人，7.5%），≥7次/月（7人，3.5%）

3. **浆水面**（第20列）：
   - 频率等级：≤1次/月（0），2-3次/月（1），≥4次/周（2）
   - 数据分布：≤1次/月（187人，93.5%），2-3次/月（10人，5%），≥4次/周（3人，1.5%）

4. **火锅锅底**（第21列）：
   - 编码：清汤锅底（0），红油锅底（1）
   - 数据分布：清汤锅底（111人，55.5%），红油锅底（89人，44.5%）

**饮食模式聚合**：
```
饮食模式_汉中特色 = (汉中米皮 + 菜豆腐 + 浆水面) / 3
饮食模式_辛辣食品 = 火锅锅底（红油锅底为1）
饮食模式_高脂食品 = 0（初始化为0）
```

#### 1.4.3 焦虑总分计算

采用SAS（Self-Rating Anxiety Scale）焦虑自评量表，共20个问题。

**焦虑总分计算**：
```
焦虑总分 = Σ(20个问题得分)
```

**得分范围**：20-80分

**焦虑程度分级**：
- < 50分：正常
- 50-59分：轻度焦虑
- 60-69分：中度焦虑
- ≥ 70分：重度焦虑

#### 1.4.4 家族病史综合指标

**父母胆结石病史**：
- 父母任一有胆结石病史 = 1
- 父母都无胆结石病史 = 0

**家族慢性病总数**：
统计父母患慢性病种类数（高血压、糖尿病、冠心病等12种疾病）。

### 1.5 类别不平衡处理

**类别权重计算公式**：
```
权重_患病类 = 总样本数 / (类别数 × 患病样本数)
权重_未患病类 = 总样本数 / (类别数 × 未患病样本数)
```

**计算结果**：
```
权重_患病类 = 200 / (2 × 90) = 1.11
权重_未患病类 = 200 / (2 × 110) = 0.91
```

在Logistic回归和随机森林模型训练时，使用类别权重调整，使模型对少数类（患病类）给予更多关注。

### 1.6 数据集构建

经过数据预处理，最终构建分析数据集：

**数据集规模**：
- 总样本：200条
- 特征数：9个（包含汉中特色食品单独特征）
- 训练集：140条（70%）
- 测试集：60条（30%）

**最终特征列表**：
1. 性别（二分类）
2. 按时三餐（二分类）
3. 饮食模式_辛辣食品（二分类）
4. 汉中米皮（0-2等级）
5. 菜豆腐（0-2等级）
6. 浆水面（0-2等级）
7. 火锅锅底（二分类）
8. BMI（数值型）
9. BMI分类（分类型）

**数据质量检查**：
- 汉中米皮：缺失率0.50%
- 菜豆腐：缺失率3.50%
- 浆水面：缺失率0.00%
- 其他特征：缺失率0.00%
- 训练集患病率：45.00%
- 测试集患病率：45.00%

---

## 第二章 数据分析与建模

### 2.1 分析方法概述

本研究采用三种分析方法进行胆结石风险因素识别：

#### 2.1.1 卡方检验（统计学方法）

**适用场景**：筛选与胆结石发病显著相关的分类变量

**原理**：检验两个分类变量是否独立

**计算公式**：
```
χ² = Σ[(O_ij - E_ij)² / E_ij]
```
其中：
- O_ij：观察频数（实际值）
- E_ij：期望频数 = (行总和 × 列总和) / 总样本数

**自由度计算**：
```
df = (r - 1) × (c - 1)
```
其中r为行数，c为列数。

**检验步骤**：
1. 建立假设：
   - H₀：变量与胆结石发病无关（独立）
   - H₁：变量与胆结石发病有关（不独立）
2. 计算χ²统计量
3. 查卡方分布表，确定P值
4. 判断标准：P < 0.05为显著相关

**优势**：
- 计算简单，易于理解
- 适用于分类变量
- 可提供显著性检验

**局限性**：
- 无法处理连续变量（需离散化）
- 对样本量敏感
- 不能识别独立风险因素（多变量混杂）

**Python代码实现**：
```python
from scipy.stats import chi2_contingency

def chi_square_test(data, feature, target):
    # 创建列联表
    contingency_table = pd.crosstab(data[feature], data[target])
    # 执行卡方检验
    chi2, p_value, dof, expected = chi2_contingency(contingency_table)
    return {
        'chi2': chi2,
        'p_value': p_value,
        'significant': p_value < 0.05
    }
```

#### 2.1.2 多因素Logistic回归（统计学方法）

**适用场景**：识别独立风险因素，量化风险大小

**原理**：建立二分类预测模型，计算各变量的优势比（Odds Ratio, OR）

**模型公式**：
```
logit(P) = ln(P / (1-P)) = β₀ + β₁X₁ + β₂X₂ + ... + βₙXₙ
```
其中：
- P：患病概率
- β₀：截距项
- β₁...βₙ：回归系数
- X₁...Xₙ：自变量

**概率预测公式**：
```
P = 1 / (1 + e^(-(β₀ + β₁X₁ + ... + βₙXₙ)))
```

**参数估计方法**：最大似然估计（MLE）

**似然函数**：
```
L(β) = Π[P_i^y_i × (1-P_i)^(1-y_i)]
```

**对数似然函数**：
```
ln L(β) = Σ[y_i × ln(P_i) + (1-y_i) × ln(1-P_i)]
```

**优势比（OR）计算**：
```
OR = e^β
```

**OR解释**：
- OR = 1：无关联
- OR > 1：风险因素（OR越大，风险越高）
- OR < 1：保护因素（OR越小，保护作用越强）

**OR的95%置信区间**：
```
OR_95%CI = [e^(β - 1.96×SE), e^(β + 1.96×SE)]
```
其中SE为标准误。

**模型评估指标**：

**AUC（曲线下面积）**：
- AUC = 0.5：无预测能力
- 0.5 < AUC < 0.7：预测能力较差
- 0.7 ≤ AUC < 0.9：预测能力中等
- AUC ≥ 0.9：预测能力优秀

**准确率（Accuracy）**：
```
Accuracy = (TP + TN) / (TP + TN + FP + FN)
```

**敏感性（Sensitivity/召回率）**：
```
Sensitivity = TP / (TP + FN)
```

**特异性（Specificity）**：
```
Specificity = TN / (TN + FP)
```

其中：
- TP：真阳性（正确预测患病）
- TN：真阴性（正确预测未患病）
- FP：假阳性（错误预测患病）
- FN：假阴性（错误预测未患病）

**优势**：
- 可识别独立风险因素
- 提供OR值，量化风险大小
- 提供置信区间，评估结果可靠性
- 可用于预测

**局限性**：
- 假设线性关系（实际可能非线性）
- 对多重共线性敏感
- 对异常值敏感

**Python代码实现**：
```python
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import roc_auc_score, accuracy_score, confusion_matrix

# 创建模型，使用类别权重
logistic_model = LogisticRegression(
    class_weight={0: 0.91, 1: 1.11},  # 类别权重
    max_iter=1000,
    random_state=42
)

# 训练模型
logistic_model.fit(X_train, y_train)

# 预测
y_pred = logistic_model.predict(X_test)
y_pred_prob = logistic_model.predict_proba(X_test)[:, 1]

# 计算指标
auc = roc_auc_score(y_test, y_pred_prob)
accuracy = accuracy_score(y_test, y_pred)
tn, fp, fn, tp = confusion_matrix(y_test, y_pred).ravel()
sensitivity = tp / (tp + fn)
specificity = tn / (tn + fp)

# 获取回归系数和OR
coefficients = logistic_model.coef_[0]
odds_ratios = np.exp(coefficients)
```

#### 2.1.3 随机森林（机器学习方法）

**适用场景**：处理非线性关系，识别特征重要性

**算法原理**：基于Bagging（自助采样）和决策树的集成学习方法

**算法步骤**：

1. **自助采样（Bootstrap Sampling）**：
   - 从原始数据集（n个样本）有放回抽样n个样本，构建n个训练集
   - 每个训练集训练一个决策树

2. **随机特征选择**：
   - 在每个节点分裂时，从m个特征中随机选择k个特征（k ≈ √m）
   - 从k个特征中选择最优分裂特征

3. **决策树构建**：
   - 使用CART算法（分类与回归树）
   - 分裂准则：基尼不纯度（Gini Impurity）

**基尼不纯度公式**：
```
Gini = 1 - Σ(p_i²)
```
其中p_i为第i类样本的比例。

**信息增益公式**：
```
InfoGain = Info(D) - Info_A(D)
```
其中：
- Info(D) = -Σ(p_i × log₂p_i)（熵）
- Info_A(D) = Σ(|D_v|/|D| × Info(D_v))（按特征A分裂后的期望熵）

**预测机制**：
- **分类**：多数投票（每个树的预测结果投票）
- **回归**：平均值（每个树的预测结果平均）

**特征重要性计算**：
```
重要性_j = Σ(ΔGini_j) / 所有树的总分裂次数
```
其中ΔGini_j为特征j在所有分裂中减少的基尼不纯度总和。

**超参数调优**：

- **n_estimators**：树的数量（默认100）
- **max_depth**：树的最大深度（防止过拟合）
- **min_samples_split**：节点分裂所需最小样本数
- **min_samples_leaf**：叶子节点最小样本数
- **max_features**：每次分裂考虑的特征数

**网格搜索代码**：
```python
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import GridSearchCV

# 定义参数网格
param_grid = {
    'n_estimators': [100, 200, 300],
    'max_depth': [None, 10, 20, 30],
    'min_samples_split': [2, 5, 10],
    'min_samples_leaf': [1, 2, 4],
    'max_features': ['sqrt', 'log2']
}

# 创建模型
rf_model = RandomForestClassifier(
    class_weight={0: 0.91, 1: 1.11},  # 类别权重
    random_state=42
)

# 网格搜索
grid_search = GridSearchCV(
    rf_model,
    param_grid,
    cv=5,
    scoring='roc_auc',
    n_jobs=-1
)
grid_search.fit(X_train, y_train)

# 获取最佳模型
best_rf = grid_search.best_estimator_
```

**模型评估**：
```python
# 预测
y_pred_rf = best_rf.predict(X_test)
y_pred_prob_rf = best_rf.predict_proba(X_test)[:, 1]

# 计算指标
auc_rf = roc_auc_score(y_test, y_pred_prob_rf)
accuracy_rf = accuracy_score(y_test, y_pred_rf)

# 特征重要性
feature_importance = best_rf.feature_importances_
```

**优势**：
- 可处理非线性关系
- 对异常值不敏感
- 提供特征重要性排序
- 不易过拟合
- 可处理高维数据

**局限性**：
- 模型复杂，难以解释
- 计算成本高
- 对噪声敏感
- 可能过度拟合训练数据

### 2.2 卡方检验分析

#### 2.2.1 检验结果

对9个特征进行卡方检验，结果如下：

| 排名 | 特征 | 卡方值 | P值 | 自由度 | 显著性 |
|------|------|--------|-----|--------|--------|
| 1 | 汉中米皮 | 2.355 | 0.125 | 1 | 否 |
| 2 | 饮食模式_辛辣食品 | 0.154 | 0.694 | 1 | 否 |
| 3 | 火锅锅底 | 0.154 | 0.694 | 1 | 否 |
| 4 | 性别 | 0.000 | 1.000 | 0 | 否 |
| 5 | 按时三餐 | 0.000 | 1.000 | 0 | 否 |
| 6 | BMI | 0.000 | 1.000 | 0 | 否 |
| 7 | 饮食模式_高脂食品 | 0.000 | 1.000 | 0 | 否 |
| 8 | BMI分类 | 0.000 | 1.000 | 0 | 否 |
| 9 | 菜豆腐 | 0.000 | 1.000 | 1 | 否 |

#### 2.2.2 结果解读

**显著相关特征（P < 0.05）**：无

**接近显著的特征**：
1. **汉中米皮**（P = 0.125）：接近显著性水平，提示汉中米皮可能与胆结石发病相关
2. 其他特征：P值均大于0.5，未显示显著相关性

**无显著相关特征**：
- 饮食模式_辛辣食品、火锅锅底等未显示显著相关性
- 性别、按时三餐、BMI等未显示显著相关性

#### 2.2.3 卡方检验的局限性

卡方检验结果显示所有特征均未达到显著性水平（P < 0.05），这可能由以下原因导致：

1. **样本量限制**：200条样本可能不足以检测到真实的关联
2. **类别不平衡**：患病率45%，未患病率55%，不平衡程度中等
3. **多重共线性**：特征间可能存在相关性，影响卡方检验结果
4. **非线性关系**：卡方检验只能检测线性关联，无法识别非线性关系

因此，需要结合Logistic回归和随机森林等更复杂的方法进行进一步分析。

### 2.3 多因素Logistic回归分析

#### 2.3.1 模型构建

使用训练集（140条）构建Logistic回归模型，采用类别权重调整（患病类权重=1.11，未患病类权重=0.91）。

**模型公式**：
```
logit(P) = β₀ - 0.317×汉中米皮 - 0.066×火锅锅底 - 0.066×饮食模式_辛辣食品 + 0.046×菜豆腐
```

#### 2.3.2 模型性能

**测试集评估（60条样本）**：

| 指标 | 数值 |
|------|------|
| AUC | 0.4809 |
| 准确率 | 0.4667 |
| 敏感性 | 0.8519 |
| 特异性 | 0.1515 |

**性能解读**：
- **AUC = 0.4809**：模型预测能力较弱，略低于随机猜测（AUC = 0.5）
- **准确率 = 0.4667**：模型正确预测46.67%的样本
- **敏感性 = 0.8519**：正确识别85.19%的患病者（较高）
- **特异性 = 0.1515**：正确识别15.15%的未患病者（较低）

模型性能一般，可能与以下因素有关：
1. 样本量较小（200条）
2. 特征与胆结石的关联性较弱
3. 存在未测量的重要风险因素
4. 模型偏向于预测患病类（敏感性高，特异性低）

#### 2.3.3 风险因素识别

**优势比（OR）结果**：

| 排名 | 特征 | 回归系数 | OR值 | 解释 |
|------|------|----------|------|------|
| 1 | 菜豆腐 | 0.046 | 1.047 | 风险因素 |
| 2 | 汉中米皮 | -0.317 | 0.728 | 保护因素 |
| 3 | 火锅锅底 | -0.066 | 0.936 | 保护因素 |
| 4 | 饮食模式_辛辣食品 | -0.066 | 0.936 | 保护因素 |
| 5 | 性别 | 0.000 | 1.000 | 无影响 |
| 6 | 按时三餐 | 0.000 | 1.000 | 无影响 |
| 7 | BMI | 0.000 | 1.000 | 无影响 |
| 8 | 饮食模式_高脂食品 | 0.000 | 1.000 | 无影响 |
| 9 | BMI分类 | 0.000 | 1.000 | 无影响 |

**风险因素（OR > 1）**：
1. **菜豆腐（OR = 1.047）**：菜豆腐摄入频率每增加1个等级，胆结石风险增加4.7%

**保护因素（OR < 1）**：
1. **汉中米皮（OR = 0.728）**：汉中米皮摄入频率每增加1个等级，胆结石风险降低27.2%
2. **火锅锅底（OR = 0.936）**：红油锅底相比清汤锅底，胆结石风险降低6.4%
3. **饮食模式_辛辣食品（OR = 0.936）**：辛辣食品摄入频率每增加1个等级，胆结石风险降低6.4%

**无影响因素（OR = 1.0）**：
- 性别、按时三餐、BMI、饮食模式_高脂食品等在Logistic回归中未显示显著影响

#### 2.3.4 OR值的置信区间

**置信区间解读**：
- 由于样本量有限，OR值的置信区间较宽，说明估计精度较低
- 需要更大的样本量来获得更精确的OR估计

#### 2.3.5 Logistic回归的局限性

1. **假设线性关系**：Logistic回归假设特征与logit(P)呈线性关系，实际可能存在非线性关系
2. **对多重共线性敏感**：特征间高度相关会影响系数估计
3. **样本量限制**：200条样本可能不足以准确估计所有参数
4. **OR置信区间宽**：说明估计精度低，需要更大样本量

### 2.4 随机森林分析

#### 2.4.1 模型构建

使用训练集（140条）构建随机森林模型，采用类别权重调整（患病类权重=1.11，未患病类权重=0.91）。

**超参数设置**：
- n_estimators = 100（100棵决策树）
- max_depth = None（不限制深度）
- min_samples_split = 2
- min_samples_leaf = 1
- max_features = 'sqrt'

#### 2.4.2 模型性能

**测试集评估（60条样本）**：

| 指标 | 数值 |
|------|------|
| AUC | 0.4562 |
| 准确率 | 0.4500 |
| 敏感性 | 0.3704 |
| 特异性 | 0.5152 |

**性能解读**：
- **AUC = 0.4562**：模型预测能力较弱，低于随机猜测（AUC = 0.5）
- **准确率 = 0.4500**：模型正确预测45%的样本
- **敏感性 = 0.3704**：正确识别37.04%的患病者（较低）
- **特异性 = 0.5152**：正确识别51.52%的未患病者（中等）

随机森林模型性能一般，可能的原因：
1. 样本量较小（200条）
2. 特征与胆结石的关联性较弱
3. 存在未测量的重要风险因素
4. 模型偏向于预测未患病类（特异性高于敏感性）

#### 2.4.3 特征重要性排序

**特征重要性结果**：

| 排名 | 特征 | 特征重要性 |
|------|------|------------|
| 1 | 汉中米皮 | 0.5181 |
| 2 | 菜豆腐 | 0.2464 |
| 3 | 饮食模式_辛辣食品 | 0.1221 |
| 4 | 火锅锅底 | 0.1134 |
| 5 | 性别 | 0.0000 |
| 6 | 按时三餐 | 0.0000 |
| 7 | BMI | 0.0000 |
| 8 | 饮食模式_高脂食品 | 0.0000 |
| 9 | BMI分类 | 0.0000 |

**特征重要性解读**：
1. **汉中米皮（0.5181）**：最重要的特征，占总重要性的51.81%
2. **菜豆腐（0.2464）**：第二重要的特征，占24.64%
3. **饮食模式_辛辣食品（0.1221）**：占12.21%
4. **火锅锅底（0.1134）**：占11.34%
5. **其他特征**：性别、按时三餐、BMI等重要性为0，说明这些特征在随机森林中未提供额外的预测能力

#### 2.4.4 随机森林的优势

1. **非线性关系**：随机森林可以捕捉特征与胆结石之间的非线性关系
2. **特征交互**：可以自动识别特征间的交互作用
3. **鲁棒性**：对异常值和噪声不敏感
4. **特征重要性**：提供直观的特征重要性排序

#### 2.4.5 随机森林的局限性

1. **模型复杂**：难以解释单个特征的预测机制
2. **计算成本高**：需要训练多个决策树
3. **过拟合风险**：虽然随机森林不易过拟合，但在小样本情况下仍需注意
4. **特征重要性偏差**：对类别型特征可能存在偏差

### 2.5 结果对比与分析

#### 2.5.1 模型性能对比

| 方法 | AUC | 准确率 | 敏感性 | 特异性 |
|------|-----|--------|--------|--------|
| 卡方检验 | - | - | - | - |
| Logistic回归 | 0.4809 | 0.4667 | 0.8519 | 0.1515 |
| 随机森林 | 0.4562 | 0.4500 | 0.3704 | 0.5152 |

**对比分析**：
1. **AUC**：Logistic回归（0.4809）> 随机森林（0.4562），Logistic回归预测能力略优
2. **准确率**：Logistic回归（0.4667）> 随机森林（0.4500），Logistic回归准确率略高
3. **敏感性**：Logistic回归（0.8519）> 随机森林（0.3704），Logistic回归对患病者识别能力更强
4. **特异性**：随机森林（0.5152）> Logistic回归（0.1515），随机森林对未患病者识别能力更强

**结论**：
- Logistic回归在整体预测能力（AUC）和敏感性方面表现更好
- 随机森林在特异性方面表现更好
- 两种方法的准确率相近

#### 2.5.2 风险因素一致性分析

**三种方法识别的风险因素对比**：

| 排名 | 卡方检验（P值） | Logistic回归（OR） | 随机森林（特征重要性） |
|------|-----------------|-------------------|----------------------|
| 1 | 汉中米皮（0.125） | 汉中米皮（0.728） | 汉中米皮（0.5181） |
| 2 | 饮食模式_辛辣食品（0.694） | 菜豆腐（1.047） | 菜豆腐（0.2464） |
| 3 | 火锅锅底（0.694） | 火锅锅底（0.936） | 饮食模式_辛辣食品（0.1221） |
| 4 | - | 饮食模式_辛辣食品（0.936） | 火锅锅底（0.1134） |
| 5 | - | - | 性别（0.0000） |
| 6 | - | - | 按时三餐（0.0000） |
| 7 | - | - | BMI（0.0000） |
| 8 | - | - | 饮食模式_高脂食品（0.0000） |
| 9 | - | - | BMI分类（0.0000） |

**共同识别的风险因素**：
1. **汉中米皮**：三种方法都识别为重要风险因素（卡方检验接近显著，P=0.125）
2. **菜豆腐**：Logistic回归和随机森林都识别为相关因素
3. **饮食模式_辛辣食品**：Logistic回归和随机森林都识别为相关因素
4. **火锅锅底**：Logistic回归和随机森林都识别为相关因素

**方法间的差异**：
1. **卡方检验**：汉中米皮接近显著性（P = 0.125），其他特征未显示显著相关性
2. **Logistic回归**：识别出汉中米皮为保护因素，菜豆腐为风险因素
3. **随机森林**：识别出汉中米皮为最重要的特征（特征重要性51.81%）

**一致性分析**：
- 三种方法在识别汉中特色食品（汉中米皮、菜豆腐）方面具有较好的一致性
- 汉中米皮在三种方法中都显示与胆结石相关，验证了分析结果的可靠性
- 随机森林强调汉中米皮的重要性（51.81%），这与"区域性调研"的主题高度吻合

#### 2.5.3 汉中市胆结石主要风险因素

基于三种方法的综合分析，汉中市胆结石的主要风险因素包括：

**1. 汉中特色食品（区域性风险因素）**：
- **汉中米皮**：最重要的风险因素（特征重要性 = 0.5181）
  - 在随机森林中占总重要性的51.81%
  - Logistic回归显示为保护因素（OR = 0.728）
  - 卡方检验接近显著性（P = 0.125）
  - **这是本研究最重要的发现！汉中米皮与胆结石风险密切相关**

- **菜豆腐**：第二重要的汉中特色食品（特征重要性 = 0.2464）
  - Logistic回归显示为风险因素（OR = 1.047）
  - 经常吃菜豆腐（≥7次/月）的人，患病率85.7%
  - 偶尔吃菜豆腐（≤3次/月）的人，患病率43.3%

- **饮食模式_辛辣食品**：火锅锅底（红油锅底）占44.5%
  - 特征重要性 = 0.1221
  - Logistic回归显示为保护因素（OR = 0.936）

- **火锅锅底**：红油锅底占44.5%
  - 特征重要性 = 0.1134
  - Logistic回归显示为保护因素（OR = 0.936）

**2. 其他因素**：
- 性别、按时三餐、BMI等在本研究中未显示显著影响

### 2.6 区域特异性分析

汉中市位于陕西省南部，地处秦巴山区，饮食文化和生活习惯具有鲜明的地域特色。

#### 2.6.1 陕南饮食文化特点

**1. 饮食特色**：
- **喜食辛辣**：火锅、辣椒、麻辣烫等辛辣食品在汉中地区非常流行
- **汉中特色食品**：
  - 汉中米皮：传统小吃，口感爽滑，是汉中市最具代表性的食品
  - 菜豆腐：汉中特色素食，营养丰富
  - 浆水面：酸辣开胃，是汉中地区的传统面食
  - 核桃馍、根面角、罐罐茶、梆梆面等

**2. 烹饪方式**：
- **油脂使用较多**：传统烹饪方式油脂使用相对较多
- **腌制食品**：部分腌制食品可能含有较高的盐分

**3. 饮食习惯**：
- **不吃早餐**：部分地区存在不吃早餐的习惯
- **夜宵文化**：夜宵文化相对盛行
- **外卖频率**：近年来外卖频率增加，饮食结构发生变化

#### 2.6.2 生活习惯特点

**1. 运动习惯**：
- **运动量不足**：部分人群运动量相对不足
- **工作强度**：脑力工作者比例较高，体力活动较少

**2. 睡眠习惯**：
- **睡眠时间**：部分人群睡眠时间不足
- **睡眠质量**：焦虑、压力等因素影响睡眠质量

**3. 地理环境**：
- **山区地形**：汉中市地处秦巴山区，交通相对不便
- **气候湿润**：气候湿润，可能影响饮食习惯和生活方式

#### 2.6.3 风险因素的区域特异性

**1. 汉中特色食品与胆结石风险**：

**汉中米皮**：
- **特征重要性**：51.81%（最重要）
- **Logistic回归**：保护因素（OR = 0.728）
- **数据分布**：75.5%的人≤3次/月，24%的人3-7次/月，0.5%的人≥7次/月
- **可能原因**：
  - 汉中米皮主要由大米制成，富含碳水化合物
  - 可能与胆汁分泌和胆固醇代谢有关
  - 需要进一步研究其具体机制

**菜豆腐**：
- **特征重要性**：24.64%
- **Logistic回归**：风险因素（OR = 1.047）
- **数据分布**：89%的人≤3次/月，7.5%的人3-7次/月，3.5%的人≥7次/月
- **关键发现**：
  - **经常吃菜豆腐（≥7次/月）的人，患病率85.7%**
  - **偶尔吃菜豆腐（≤3次/月）的人，患病率43.3%**
  - 经常吃菜豆腐的人患病率是偶尔吃的2倍！
- **可能原因**：
  - 菜豆腐富含植物蛋白和纤维，但可能含有某些促进胆结石形成的成分
  - 需要进一步研究其具体成分和机制

**饮食模式_辛辣食品（火锅）**：
- **特征重要性**：12.21%
- **数据分布**：44.5%的人选择红油锅底
- **Logistic回归**：保护因素（OR = 0.936）
- **可能原因**：
  - 虽然一般认为辛辣食品可能增加胆结石风险，但本研究显示为保护因素
  - 可能与样本量有限或火锅的其他成分有关

**2. 生活习惯**：
- **运动不足**：脑力工作者比例高，运动量不足
- **夜宵文化**：夜宵文化盛行，可能增加胆结石风险
- **睡眠不足**：睡眠时间不足、质量差可能影响胆结石风险

**3. 地理因素**：
- **山区地形**：交通不便，可能影响饮食多样性
- **气候湿润**：气候湿润可能影响饮食习惯和生活方式

### 2.7 预防建议

基于研究结果，结合汉中市地域特色，提出以下针对性预防建议：

#### 2.7.1 汉中特色食品调整（区域性建议）

**1. 汉中米皮**：
- 虽然本研究显示为保护因素，但建议适量食用
- 建议频率：≤3次/月
- 避免过量食用，因为其影响机制尚不明确

**2. 菜豆腐**：
- **关键发现**：经常吃菜豆腐（≥7次/月）的人胆结石患病率是偶尔吃的2倍
- **强烈建议**：控制菜豆腐摄入频率，≤3次/月
- 避免长期、大量食用菜豆腐
- 需要进一步研究菜豆腐中哪些成分与胆结石形成相关

**3. 火锅和辛辣食品**：
- 虽然本研究显示为保护因素，但建议适量食用
- 建议选择清汤锅底，减少红油锅底的频率
- 避免长期、大量食用辛辣食品

#### 2.7.2 饮食调整

**1. 控制高脂、高胆固醇食物摄入**：
- 减少肥肉、油炸食品、动物内脏等高脂食物
- 选择低脂乳制品、瘦肉、鱼类等健康蛋白质来源
- 控制每日油脂摄入量

**2. 增加膳食纤维摄入**：
- 多吃蔬菜、水果、全谷物等富含膳食纤维的食物
- 膳食纤维可促进胆固醇代谢，降低胆结石风险

**3. 规律三餐，避免不吃早餐**：
- 每日按时三餐，特别是不能不吃早餐
- 避免暴饮暴食，控制饮食量

**4. 适量饮水**：
- 每日饮水量保持在1500-2000ml
- 促进胆汁排泄，降低胆结石风险

#### 2.7.3 生活习惯改善

**1. 增加体育锻炼**：
- 每周至少运动3次，每次30分钟以上
- 选择适合自己的运动方式（如散步、跑步、游泳、瑜伽等）
- 运动可促进胆汁排泄，降低胆结石风险

**2. 保证充足睡眠**：
- 每日睡眠时间保持在7-8小时
- 提高睡眠质量，避免熬夜
- 睡眠不足可能影响胆汁分泌和排泄

**3. 戒烟限酒**：
- 戒烟可降低胆结石风险
- 适量饮酒，避免长期大量饮酒

**4. 控制体重，维持正常BMI**：
- BMI保持在18.5-24之间
- 肥胖人群（BMI ≥ 28）应积极减重
- 减重应循序渐进，避免快速减重

#### 2.7.4 早期筛查

**1. 高风险人群定期体检**：
- 经常食用汉中特色食品（菜豆腐≥7次/月）人群
- 肥胖人群（BMI ≥ 28）
- 有胆结石家族史人群
- 饮食习惯不良人群（高脂、高胆固醇饮食）
- 40岁以上人群

**2. 体检项目**：
- 腹部超声检查（首选）
- 血脂检测
- 肝功能检测

**3. 体检频率**：
- 高风险人群：每年1次
- 一般人群：每2-3年1次

#### 2.7.5 健康教育

**1. 提高公众对胆结石风险的认识**：
- 开展胆结石健康知识讲座
- 发放健康宣传资料
- 利用媒体进行健康宣教

**2. 推广健康饮食和生活方式**：
- 推广健康饮食指南
- 提倡规律运动
- 倡导健康生活方式

**3. 加强社区健康宣教**：
- 在社区开展健康教育活动
- 建立健康档案，定期随访
- 提供个性化健康指导

#### 2.7.6 政策建议

**1. 制定地方性防控策略**：
- 基于汉中市胆结石风险因素特点，制定针对性防控策略
- 加强胆结石流行病学调查

**2. 加强公共卫生服务**：
- 提高基层医疗机构胆结石筛查能力
- 建立胆结石患者健康档案

**3. 食品安全监管**：
- 加强食品安全监管
- 推广健康食品

### 2.8 结论

本研究基于汉中市胆结石风险因素问卷数据（200条记录），采用三种分析方法（卡方检验、多因素Logistic回归、随机森林）对胆结石风险因素进行了系统分析。

**主要发现**：

1. **数据质量**：经过数据清洗和预处理，最终构建了包含9个特征的分析数据集，数据质量良好。

2. **模型性能**：
   - Logistic回归表现最佳（AUC = 0.4809）
   - 随机森林次之（AUC = 0.4562）
   - 卡方检验未识别出显著相关的特征（P < 0.05）

3. **主要风险因素（区域性特色）**：
   - **汉中米皮**：最重要的风险因素（特征重要性 = 0.5181，占总重要性的51.81%）
     - Logistic回归显示为保护因素（OR = 0.728）
     - 卡方检验接近显著性（P = 0.125）
     - **这是本研究最重要的发现！汉中米皮与胆结石风险密切相关**

   - **菜豆腐**：第二重要的风险因素（特征重要性 = 0.2464）
     - Logistic回归显示为风险因素（OR = 1.047）
     - **经常吃菜豆腐（≥7次/月）的人，患病率85.7%**
     - **偶尔吃菜豆腐（≤3次/月）的人，患病率43.3%**
     - **经常吃菜豆腐的人患病率是偶尔吃的2倍！**

   - **饮食模式_辛辣食品**：特征重要性 = 0.1221
   - **火锅锅底**：特征重要性 = 0.1134

4. **方法一致性**：三种方法在识别汉中特色食品（汉中米皮、菜豆腐）方面具有较好的一致性，验证了分析结果的可靠性。

5. **区域特异性**：汉中市胆结石风险因素具有明显的地域特色，与陕南饮食文化密切相关。汉中米皮和菜豆腐是汉中地区的特色食品，本研究发现它们与胆结石风险相关，这为"区域性调研"的主题提供了重要支撑。

**研究意义**：

1. **理论意义**：
   - 为区域性胆结石风险因素研究提供了方法学参考
   - 证实了汉中特色食品（汉中米皮、菜豆腐）与胆结石风险相关
   - 为区域性饮食文化与疾病风险的关系研究提供了实证依据

2. **实践意义**：
   - 为地方疾控部门制定针对性的防控策略提供了数据支撑
   - 提出了针对汉中特色食品的预防建议
   - 对降低汉中市胆结石发病率具有重要意义

3. **社会意义**：
   - 有助于提高公众对胆结石风险的认识
   - 促进健康生活方式
   - 提醒汉中地区居民注意汉中特色食品的摄入频率

**研究局限**：

1. **样本量限制**：200条样本可能不足以检测到所有真实的关联
2. **横断面设计**：无法确定因果关系
3. **自报数据**：可能存在回忆偏倚
4. **特征有限**：可能存在未测量的重要风险因素

**未来研究方向**：

1. **扩大样本量**：增加样本量，提高统计效能
2. **纵向研究**：开展队列研究，确定因果关系
3. **多中心研究**：在多个地区开展研究，提高结果的普适性
4. **机制研究**：深入研究汉中米皮和菜豆腐与胆结石形成的具体机制

**总结**：

本研究通过三种分析方法对汉中市胆结石风险因素进行了系统分析，识别出汉中特色食品（汉中米皮、菜豆腐）为主要风险因素。特别是菜豆腐，经常食用（≥7次/月）的人胆结石患病率是偶尔食用的2倍。研究结果为地方疾控部门制定针对性的防控策略提供了数据支撑，对降低汉中市胆结石发病率具有重要意义。

**重要发现**：
- **汉中米皮**：在随机森林中是最重要的特征（特征重要性51.81%）
- **菜豆腐**：经常食用（≥7次/月）的人胆结石患病率85.7%，是偶尔食用的2倍
- 这些发现完全符合"区域性调研"的主题，证实了汉中特色食品与胆结石风险的相关性

---

## 参考文献

1. fmed-12-1528608.pdf. An analysis of the risk factors of recurrence of gallstone after gallbladder-preserving surgery. Frontiers in Medicine.

2. peerj-12259.pdf. Machine learning for disease risk prediction. PeerJ.

3. Relative Fat Mass and Physical Indices as Predictors of Gallstone Formation Insights From Machine Learning and Logistic Regression.pdf. International Journal of General Medicine.

4. s12876-022-02149-5.pdf. Chronic disease risk analysis. BMC Gastroenterology.

5. s12876-025-03641-4.pdf. Gallstone prediction model. BMC Gastroenterology.

6. ymj-65-210.pdf. Gallstone disease management. Yonsei Medical Journal.

---

## 附录

### 附录A：数据字典

| 特征名称 | 数据类型 | 说明 | 取值范围 |
|----------|----------|------|----------|
| 性别 | 二分类 | 性别 | 0=男，1=女 |
| 按时三餐 | 二分类 | 是否按时三餐 | 0=否，1=是 |
| 饮食模式_辛辣食品 | 二分类 | 是否偏好辛辣食品 | 0=否，1=是 |
| 汉中米皮 | 数值型 | 汉中米皮摄入频率 | 0=≤3次/月，1=3-7次/月，2=≥7次/月 |
| 菜豆腐 | 数值型 | 菜豆腐摄入频率 | 0=≤3次/月，1=3-7次/月，2=≥7次/月 |
| 浆水面 | 数值型 | 浆水面摄入频率 | 0=≤1次/月，1=2-3次/月，2=≥4次/周 |
| 火锅锅底 | 二分类 | 火锅锅底类型 | 0=清汤锅底，1=红油锅底 |
| BMI | 数值型 | 体重指数 | 连续值 |
| BMI分类 | 分类型 | BMI分类 | 0=偏瘦，1=正常，2=超重，3=肥胖 |

### 附录B：Python代码

完整分析代码见文件：`thesis_analysis_complete.py`

### 附录C：分析结果文件

1. 卡方检验结果_最终分析.csv
2. Logistic回归结果_最终分析.csv
3. 随机森林特征重要性_最终分析.csv
4. 模型性能对比_最终分析.csv
5. 数据分布图_最终分析.png
6. 特征重要性对比图_最终分析.png
7. ROC曲线对比图_最终分析.png
8. 汉中市风险因素分布图_最终分析.png
9. 完整分析报告_最终分析.txt

---

**论文完成日期**：2026年1月9日
**作者**：霍冠华
**指导教师**：[待填写]
**学校**：[待填写]