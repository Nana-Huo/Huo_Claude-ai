# iFlow 微信小程序

这是一个将iFlow AI功能封装为微信小程序的项目，通过中间层API服务实现与iFlow的交互。

## 项目结构

```
iFlowMiniProgram/
├── app.js           # 应用入口文件
├── app.json         # 应用配置文件
├── app.wxss         # 全局样式文件
├── pages/           # 页面目录
│   ├── index/       # 聊天页面
│   │   ├── index.js
│   │   ├── index.wxml
│   │   └── index.wxss
│   └── agents/      # 智能体列表页面
│       ├── agents.js
│       ├── agents.wxml
│       └── agents.wxss
├── sitemap.json     # 小程序收录配置
└── README.md        # 项目说明文档
```

## 功能特点

1. **聊天界面**：支持输入命令并显示AI响应
2. **智能体选择**：可以切换不同的智能体进行交互
3. **智能体状态显示**：显示当前使用的智能体
4. **响应式设计**：适配不同尺寸的设备

## 前置条件

1. 已安装 Node.js (用于运行中间层API服务)
2. 已安装 微信开发者工具 (用于开发和运行微信小程序)
3. 已安装 iFlow CLI (已在您的系统上配置)
4. 已启动中间层API服务

## 中间层API服务

在使用微信小程序之前，需要先启动中间层API服务：

```bash
# 进入中间层API服务目录
cd ../iflow-api-server

# 启动服务
npm start
```

服务将运行在 `http://localhost:4000`

## 运行微信小程序

1. 打开 **微信开发者工具**
2. 点击 "导入项目"
3. 填写项目信息：
   - AppID: 可以使用测试号 (点击 "测试号" 按钮获取)
   - 项目名称: iFlow AI
   - 项目目录: 选择 `iFlowMiniProgram` 目录
4. 点击 "导入"
5. 等待项目加载完成
6. 点击 "编译" 按钮
7. 点击 "预览" 按钮可以在手机上查看

## 使用说明

### 基本聊天
1. 在输入框中输入命令
2. 点击 "发送" 按钮
3. 等待AI响应显示在聊天界面中

### 智能体选择
1. 点击 "智能体" 按钮
2. 在智能体列表中选择一个智能体
3. 返回聊天界面，开始与该智能体交互
4. 聊天界面顶部会显示当前使用的智能体

## 开发说明

### API 接口

小程序使用以下API接口与中间层服务交互：

- `GET /health` - 健康检查
- `GET /agents` - 获取智能体列表
- `POST /execute` - 执行iFlow命令
- `POST /agent/execute/:name` - 使用特定智能体执行命令

### 配置修改

如果需要修改API服务地址，可以在 `app.js` 文件中修改：

```javascript
// app.js
App({
  globalData: {
    baseURL: 'http://localhost:4000', // 修改为您的API服务地址
    // ...
  },
  // ...
})
```

### 样式修改

全局样式可以在 `app.wxss` 文件中修改，页面样式可以在各自的 `.wxss` 文件中修改。

## 测试步骤

1. 启动中间层API服务
2. 在微信开发者工具中打开小程序
3. 测试健康检查：查看控制台输出
4. 测试聊天功能：输入简单命令，如 "Hello"
5. 测试智能体功能：选择一个智能体，然后发送命令

## 注意事项

1. **网络限制**：微信小程序要求API服务必须使用HTTPS协议，或者在开发环境中添加安全域名
2. **开发环境**：在微信开发者工具中，需要开启 "不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书" 选项
3. **跨域问题**：中间层API服务已配置CORS，允许所有域名访问
4. **响应时间**：如果命令执行时间过长，可能会超时，请确保命令简洁明了

## 故障排除

### 1. 无法连接到API服务
- 确保中间层API服务已启动
- 检查小程序中配置的API服务地址是否正确
- 检查网络连接是否正常
- 检查防火墙设置，确保端口4000已打开

### 2. 智能体列表无法加载
- 确保iFlow CLI已正确安装和配置
- 检查中间层API服务的日志输出

### 3. 命令执行失败
- 检查命令格式是否正确
- 检查iFlow CLI的权限和配置
- 检查中间层API服务的日志输出

## 未来改进

1. 添加消息历史记录功能
2. 支持多种智能体同时使用
3. 添加更多交互功能，如图文混排
4. 优化界面设计和用户体验
5. 支持离线使用功能

## 联系方式

如果您在使用过程中遇到问题，欢迎随时联系我。
