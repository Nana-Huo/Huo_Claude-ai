# 数据分析工具使用说明

## 文件说明

### 核心文件
1. **common_utils.py** - 公共工具模块
   - `DataPreprocessor` 类：数据加载和预处理
   - `ModelEvaluator` 类：模型评估工具

2. **三个模型分析文件**
   - **logistic_regression.py** - 多因素Logistic回归分析
   - **decision_tree.py** - 决策树分析
   - **random_forest.py** - 随机森林分析

3. **main_analysis.py** - 主控制脚本
   - 协调整个分析流程
   - 数据预处理 → 模型分析 → 模型对比 → 生成报告

## 使用方法

### 方法1：运行完整流程（推荐）
```bash
# 双击运行
run_main_analysis.bat

# 或命令行运行
python main_analysis.py
```

### 方法2：单独运行某个模型
如果数据已经预处理完成，可以单独运行某个模型：

```python
# 示例代码
from common_utils import DataPreprocessor
from logistic_regression import LogisticRegressionAnalyzer

# 1. 预处理数据
preprocessor = DataPreprocessor("你的数据文件.xlsx")
preprocessor.load_data()
data = preprocessor.preprocess_data("目标变量列名")

# 2. 运行Logistic回归
analyzer = LogisticRegressionAnalyzer()
results = analyzer.analyze_with_preprocessed_data(data)
```

## 数据要求

- **文件格式**：Excel (.xlsx)
- **目标变量**：二分类变量（0/1）
- **数据路径**：在代码中已设置，需要修改为你的实际路径

当前设置的数据路径：
```python
"C:\Users\霍冠华\Desktop\毕设\数据处理\处理后数据_20260104_144216.xlsx"
```

## 输出文件

### Logistic回归
- `logistic_univariate_results.csv` - 单因素分析结果
- `logistic_predictions.csv` - 预测结果
- `logistic_diagnostics.png` - 模型诊断图
- `logistic_roc_curve.png` - ROC曲线
- `logistic_probability_distribution.png` - 预测概率分布

### 决策树
- `decision_tree_feature_importance.csv` - 特征重要性
- `decision_tree_simplified.png` - 简化决策树
- `decision_tree_rules.txt` - 决策规则
- `decision_tree_learning_curve.png` - 学习曲线
- `decision_tree_roc_curve.png` - ROC曲线

### 随机森林
- `random_forest_feature_importance.csv` - 特征重要性
- `random_forest_tree_*.png` - 森林中的树
- `random_forest_trees_distribution.png` - 树的分布
- `random_forest_ensemble_analysis.png` - 集成分析
- `random_forest_roc_curve.png` - ROC曲线

### 综合输出
- `综合分析报告.md` - 完整的分析报告
- `模型对比结果.csv` - 性能对比表
- `模型对比可视化.png` - 性能对比图表

## 执行流程

```
1. main_analysis.py 启动
   ↓
2. 数据预处理 (common_utils.py)
   ↓
3. 依次运行三个模型
   - logistic_regression.py
   - decision_tree.py
   - random_forest.py
   ↓
4. 模型对比 (在main_analysis.py中)
   ↓
5. 生成综合报告
```

## 注意事项

1. **数据路径**：请确保修改代码中的数据文件路径
2. **目标变量**：运行时需要输入正确的目标变量列名
3. **依赖安装**：
   ```bash
   pip install -r requirements.txt
   ```
4. **中文显示**：已设置中文字体，如遇显示问题请安装SimHei字体

## 各模型特点

### Logistic回归
- 提供统计显著性检验
- 适合解释变量关系
- 输出OR值和置信区间

### 决策树
- 可视化决策过程
- 提取决策规则
- 处理非线性关系

### 随机森林
- 通常性能最佳
- 提供OOB评分
- 稳定性好

## 故障排除

- **找不到模块**：确保所有文件在同一目录
- **数据加载失败**：检查文件路径是否正确
- **目标变量错误**：确认输入的列名存在
- **内存不足**：数据量大时可以减少网格搜索参数