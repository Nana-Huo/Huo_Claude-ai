# 数据分析工具集使用说明

本项目包含三种独立的数据分析方法：多因素Logistic回归、决策树和随机森林。

## 文件结构

```
├── common_utils.py              # 公共工具模块（数据预处理、评估等）
├── logistic_regression_analysis.py  # Logistic回归分析
├── decision_tree_analysis.py    # 决策树分析
├── random_forest_analysis.py    # 随机森林分析
├── run_logistic.bat             # Logistic回归运行脚本
├── run_decision_tree.bat        # 决策树运行脚本
├── run_random_forest.bat        # 随机森林运行脚本
└── requirements.txt             # 依赖包列表
```

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 多因素Logistic回归分析

- **功能**：传统统计分析方法，提供详细的统计摘要和P值
- **特点**：
  - 单因素和多因素分析
  - 特征选择（逐步回归）
  - 模型诊断（VIF、残差分析）
  - 详细的统计报告

运行方式：
```bash
# 方式1：双击运行
run_logistic.bat

# 方式2：命令行运行
python logistic_regression_analysis.py
```

### 2. 决策树分析

- **功能**：机器学习方法，可解释性强
- **特点**：
  - 超参数自动调优
  - 决策树可视化
  - 特征重要性分析
  - 学习曲线分析
  - 决策规则提取

运行方式：
```bash
# 方式1：双击运行
run_decision_tree.bat

# 方式2：命令行运行
python decision_tree_analysis.py
```

### 3. 随机森林分析

- **功能**：集成学习方法，性能通常最佳
- **特点**：
  - 超参数自动调优
  - 多种特征重要性评估
  - 集成分析（预测一致性）
  - OOB评分
  - 森林中树的分析

运行方式：
```bash
# 方式1：双击运行
run_random_forest.bat

# 方式2：命令行运行
python random_forest_analysis.py
```

## 输入数据要求

- **文件格式**：Excel (.xlsx)
- **数据要求**：包含特征列和1个目标变量列
- **目标变量**：二分类变量（0/1）

## 输出结果

每种分析方法都会生成：

### 通用输出
- **性能评估**：准确率、AUC、分类报告、混淆矩阵
- **ROC曲线**：模型判别能力可视化
- **分析报告**：Markdown格式的详细报告

### 特定输出

#### Logistic回归
- `logistic_univariate_results.csv` - 单因素分析结果
- `logistic_predictions.csv` - 预测结果
- `logistic_diagnostics.png` - 模型诊断图
- `logistic_probability_distribution.png` - 预测概率分布

#### 决策树
- `decision_tree_feature_importance.csv` - 特征重要性
- `decision_tree_full.png` - 完整决策树
- `decision_tree_simplified.png` - 简化决策树
- `decision_tree_rules.txt` - 决策规则文本
- `decision_tree_learning_curve.png` - 学习曲线

#### 随机森林
- `random_forest_feature_importance.csv` - 特征重要性
- `random_forest_tree_*.png` - 森林中的树
- `random_forest_trees_distribution.png` - 树的分布
- `random_forest_ensemble_analysis.png` - 集成分析
- `random_forest_feature_correlation.png` - 特征相关性

## 使用步骤

1. **准备数据**：确保Excel文件包含特征和目标变量
2. **安装依赖**：运行 `pip install -r requirements.txt`
3. **选择方法**：根据需求选择分析方法
4. **运行分析**：双击对应的bat文件或运行Python脚本
5. **查看结果**：查看生成的图表和报告

## 方法选择建议

- **Logistic回归**：
  - 需要统计推断和P值
  - 变量间关系相对简单
  - 强调模型可解释性

- **决策树**：
  - 需要清晰的决策规则
  - 数据可能存在非线性关系
  - 需要可视化决策过程

- **随机森林**：
  - 追求最佳预测性能
  - 数据复杂，特征较多
  - 需要稳健的模型

## 注意事项

1. 确保目标变量是二分类的（0/1）
2. 数据文件路径在代码中已设置，如需修改请编辑对应的Python文件
3. 运行时会提示输入目标变量列名，请确保输入正确
4. 分析结果保存在当前目录下

## 故障排除

- **ImportError**：请确保已安装所有依赖包
- **FileNotFoundError**：请检查数据文件路径是否正确
- **KeyError**：请确认输入的目标变量列名存在于数据中
- **内存不足**：如数据量很大，可以尝试减少网格搜索的参数范围